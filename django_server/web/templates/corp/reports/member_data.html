{% extends 'corp/reports/base_reports.html' %}
{% load filters %}
{% load static %}

{% block style %}
<title>Member Report - Helgast Auth</title>
{% endblock %}

{% block content %}
<main class="row flex-nowrap m-0 bg-dark min-vh-100 overflow-auto">
    <div class="my-3">
        <div class="d-flex align-items-center mb-3">
            <div class="me-3">
                <img src="https://images.evetech.net/corporations/98628176/logo?size=128" class="rounded">
            </div>
            <div class="text-light">
                <div>
                    <h2>Helgast Militarum</h2>
                    <h3>Member Report</h3>
                </div>
            </div>
        </div>
        <div class="card col-12 col-md-8 mx-auto bg-dark text-light">
            <div class="card-header">
                Select Member
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <div class="from-group">
                        <label for="user">Select One Member</label>
                        <select name="user" id="user" class="form-select">
                            <option value="" disabled selected>Select One Member</option>
                            {% for user in list_user %}
                            <option value="{{user.id}}">{{user.username}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div id="character_selector" class="from-group">
                        <label for="char">Select One Member Character:</label>
                        <select name="char" id="char" class="form-select" required>
                            <option value="" disabled selected> Select One Character</option>
                            {% for char in list_characters %}
                            <option class="char user-{{char.user_character.id}}" value="{{char.id}}"
                                style="display: none;">{{char.characterName}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="option">Kind of information</label>
                        <select name="option" class="form-select" required>
                            <option value="" disabled selected>Select One Option</option>
                            <option value="1">Assets</option>
                            <option value="2">Wallet Transsactions</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ref_filter">Transactions filter</label>
                        <select name="ref_filter" class="form-select" multiple size="5">
                            {% for ref_type in list_ref_types %}
                            <option value="{{ref_type}}">{{ref_type}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-danger w-100 mt-2">Check Character Data</button>
                </form>
            </div>
        </div>
        {% if assets %}
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="csv">
            <input type="hidden" name="char" value="{{char.id}}">
            <input type="hidden" name="option" value="1">
            <button class="btn active btn-primary">Exportar Assets a CSV</button>
        </form>

        <div class="card col-12 col-md-10 bg-dark text-light my-1 mx-auto">
            <div class="card-header">
                Asset Data
            </div>
            <table class="table footer w-100 text-light">
                <thead>
                    <tr>
                        <th></th>
                        <th>Item Name</th>
                        <th>Quantity</th>
                        <th>Location</th>
                        <th>Location Flag</th>
                    </tr>
                </thead>
                <tbody>
                    {% if assets %}
                    {% for asset in assets %}
                    <tr>
                        <td>
                            <img class="item-icon" src="https://image.eveonline.com/Type/{{asset.item.eve_id}}_32.png">
                        </td>
                        <td>
                            {{asset.item.name}}
                        </td>
                        <td>{{asset.quantity}}</td>
                        <td>{{asset.location}}</td>
                        <td>{{asset.loc_flag}}</td>
                    </tr>
                    {% endfor %}
                    {% endif %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% if transactions %}
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="csv">
            <input type="hidden" name="char" value="{{char.id}}">
            <input type="hidden" name="option" value="2">
            <button class="btn active btn-primary">Exportar Transfers a CSV</button>
        </form>

        <div class="card col-12 mx-auto bg-dark text-light my-1">
            <div class="card-header">
                Wallet Transactions
            </div>
            <table class="table bo footer w-100 text-light">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Balance</th>
                        <th>Context</th>
                        <th>Reason</th>
                        <th>Ref</th>
                        <th>Target</th>
                    </tr>
                </thead>
                <tbody>
                    {% for trans in transactions %}
                    <tr>
                        <td>{{trans.date}}</td>
                        <td>{{trans.amount}}</td>
                        <td>{{trans.balance}}</td>
                        <td>{{trans.context}}</td>
                        <td>{{trans.reason}}</td>
                        <td>{{trans.ref_type}}</td>
                        <td>{{trans.target}}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
</main>
<script src="{% static 'js/member_data.js' %}"></script>
{% endblock %}